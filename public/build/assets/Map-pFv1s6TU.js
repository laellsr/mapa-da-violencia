import{createApp as q,ref as e,onMounted as F,toRaw as J,watch as $}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function P(s,t){var p=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),m=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),h=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),v=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});t.marker([-9.659,-35.701],{icon:p}).addTo(s.value),t.marker([-9.659,-35.702],{icon:m}).addTo(s.value),t.marker([-9.659,-35.703],{icon:h}).addTo(s.value),t.marker([-9.659,-35.704],{icon:p}).addTo(s.value),t.marker([-9.659,-35.705],{icon:v}).addTo(s.value)}q({setup(){const s=window.location.protocol+"//"+window.location.host+"/api/",t=e(""),p=e(!1),m=e([]),h=e([]),v=e(""),S=e(!1),D=e([]),G=e([]),f=e({}),w=e({}),n=e([]),N=e(14),T=e([]),u=e({}),g=e({}),y=e({});let b=new AbortController,k=b.signal;const A=e([]),M=e(0),C=e([]);F(async()=>{w.value=new bootstrap.Offcanvas("#LocationInfo");var o=L.layerGroup(),l=L.layerGroup(),r=[];r.push(o),await fetch(s+"reports/crimes").then(c=>c.json()).then(c=>{c.forEach(i=>{let d=[];i.reports.forEach(_=>{let R=L.marker([Number(_.lat),Number(_.lon)]);d.push(R)});let U=L.layerGroup(d);T.value[i.name]=U,r.push(U),A.value.push(d.length),C.value.push(i.name),M.value+=d.length})}).catch(c=>console.error(c)),n.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:r,minZoom:3,maxZoom:18,maxBounds:L.latLngBounds([-90,-180],[90,180]),wraparound:!0}).setView([-9.663136558749533,-35.71422457695007],N.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{noWrap:!0,worldCopyJump:!0}).addTo(n.value),L.control.zoom({position:"bottomright"}).addTo(n.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(n.value),P(n,L);var a={'<input type="date">':l,"em até 3 meses":o};L.control.layers(a,J(T.value),{position:"topright",collapsed:!1,sortLayers:!0}).addTo(n.value)}),$(t,o=>{if(b.abort(),b=new AbortController,k=b.signal,o.includes("booking.com")){B(o,k);return}fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(o)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:k}).then(l=>l.json()).then(l=>{m.value=[],h.value=l,l.forEach(r=>{let a=r.display_name.indexOf(","),c=r.display_name.substring(a+1).trim(),i=r.address.postcode!==void 0?` - ${r.address.postcode}`:"";m.value.push({display:`${r.name} <span class="text-black-50 fst-italic">- ${c}${i}</span>`})})}).catch(l=>{l.name!=="AbortError"&&console.error("Another error: ",l)})});function B(o,l){var r;fetch(s+"external",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o})}).then(a=>a.text()).then(a=>{let i=new DOMParser().parseFromString(a,"text/html");r=i.querySelector("#hp_hotel_name > div > h2").innerText;let d=i.querySelector("#hotel_address").getAttribute("data-atlas-latlng").split(",");return fetch("https://nominatim.openstreetmap.org/reverse?lat="+d[0]+"&lon="+d[1]+"&format=jsonv2",{signal:l})}).then(a=>a.json()).then(a=>{z(),a.name=r,u.value=a,x(),O(),j(),w.value.show()}).catch(a=>console.error(a))}function z(){p.value=!1,t.value=""}function E(o){z(),u.value=h.value[o],x(),O(),j(),w.value.show()}function I(o){S.value=!1,f.value=G.value[o],v.value=f.value.name,localStorage.setItem("currentLocationModal",JSON.stringify(f.value))}function x(){Object.keys(g.value).length!==0&&n.value.removeLayer(g.value),g.value=L.geoJSON(u.value.geojson,{style:{fill:!1}}),g.value.addTo(n.value)}function O(){Object.keys(y.value).length!==0&&n.value.removeLayer(y.value),y.value=L.marker([Number(u.value.lat),Number(u.value.lon)]),y.value.addTo(n.value)}function j(){let o=u.value.boundingbox.map(Number);n.value.fitBounds([[o[0],o[2]],[o[1],o[3]]])}return{query:t,recommendations:m,barFocus:p,currentLocation:u,selectSearchBarItem:E,queryModal:v,recommendationsModal:D,barFocusModal:S,currentLocationModal:f,selectSearchBarItemModal:I,maceioCrimesData:A,maceioCrimesTotalData:M,maceioCrimesLabelData:C}}}).mount("#app");
