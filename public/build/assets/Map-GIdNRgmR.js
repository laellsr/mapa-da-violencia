import{createApp as q,ref as a,onMounted as F,toRaw as J,watch as I}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function P(i,n){var m=n.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),h=n.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),g=n.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),v=n.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});n.marker([-9.659,-35.701],{icon:m}).addTo(i.value),n.marker([-9.659,-35.702],{icon:h}).addTo(i.value),n.marker([-9.659,-35.703],{icon:g}).addTo(i.value),n.marker([-9.659,-35.704],{icon:m}).addTo(i.value),n.marker([-9.659,-35.705],{icon:v}).addTo(i.value)}q({setup(){const i=window.location.protocol+"//"+window.location.host+"/api/",n=a(""),m=a(!1),h=a([]),g=a([]),v=a(""),S=a(!1),k=a([]),T=a([]),y=a({}),A=a({}),s=a([]),G=a(14),M=a([]),u=a({}),b=a({}),w=a({});let d=new AbortController,f=d.signal;const x=a([]),C=a(0),z=a([]);F(async()=>{A.value=new bootstrap.Offcanvas("#LocationInfo");var e=L.layerGroup(),o=L.layerGroup(),t=[];t.push(e),await fetch(i+"reports/crimes").then(l=>l.json()).then(l=>{l.forEach(c=>{let p=[];c.reports.forEach(E=>{let B=L.marker([Number(E.lat),Number(E.lon)]);p.push(B)});let D=L.layerGroup(p);M.value[c.name]=D,t.push(D),x.value.push(p.length),z.value.push(c.name),C.value+=p.length})}).catch(l=>console.error(l)),s.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:t,minZoom:3,maxZoom:18,maxBounds:L.latLngBounds([-90,-180],[90,180]),wraparound:!0}).setView([-9.663136558749533,-35.71422457695007],G.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{noWrap:!0,worldCopyJump:!0}).addTo(s.value),L.control.zoom({position:"bottomright"}).addTo(s.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(s.value),P(s,L);var r={'<input type="date">':o,"em até 3 meses":e};L.control.layers(r,J(M.value),{position:"topright",collapsed:!1,sortLayers:!0}).addTo(s.value)}),I(n,e=>{if(d.abort(),d=new AbortController,f=d.signal,e.includes("booking.com")){N(e,f);return}fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(e)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:f}).then(o=>o.json()).then(o=>{h.value=[],g.value=o,o.forEach(t=>{let r=t.display_name.indexOf(","),l=t.display_name.substring(r+1).trim(),c=t.address.postcode!==void 0?` - ${t.address.postcode}`:"";h.value.push({display:`${t.name} <span class="text-black-50 fst-italic">- ${l}${c}</span>`})})}).catch(o=>{o.name!=="AbortError"&&console.error("Another error: ",o)})});function N(e,o){var t;fetch(i+"external",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})}).then(r=>r.text()).then(r=>{let c=new DOMParser().parseFromString(r,"text/html");t=c.querySelector("#hp_hotel_name > div > h2").innerText;let p=c.querySelector("#hotel_address").getAttribute("data-atlas-latlng").split(",");return fetch("https://nominatim.openstreetmap.org/reverse?lat="+p[0]+"&lon="+p[1]+"&format=jsonv2",{signal:o})}).then(r=>r.json()).then(r=>{O(),r.name=t,u.value=r,j(),_(),U(),A.value.show()}).catch(r=>console.error(r))}function O(){m.value=!1,n.value=""}function R(e){O(),u.value=g.value[e],j(),_(),U(),A.value.show()}I(v,e=>{d.abort(),d=new AbortController,f=d.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(e)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:f}).then(o=>o.json()).then(o=>{k.value=[],T.value=o,o.forEach(t=>{let r=t.display_name.indexOf(","),l=t.display_name.substring(r+1).trim(),c=t.address.postcode!==void 0?` - ${t.address.postcode}`:"";k.value.push({display:`${t.name} <span class="text-black-50 fst-italic">- ${l}${c}</span>`})})}).catch(o=>{o.name!=="AbortError"&&console.error("Another error: ",o)})});function $(e){S.value=!1,y.value=T.value[e],v.value=y.value.name,localStorage.setItem("currentLocationModal",JSON.stringify(y.value))}function j(){Object.keys(b.value).length!==0&&s.value.removeLayer(b.value),b.value=L.geoJSON(u.value.geojson,{style:{fill:!1}}),b.value.addTo(s.value)}function _(){Object.keys(w.value).length!==0&&s.value.removeLayer(w.value),w.value=L.marker([Number(u.value.lat),Number(u.value.lon)]),w.value.addTo(s.value)}function U(){let e=u.value.boundingbox.map(Number);s.value.fitBounds([[e[0],e[2]],[e[1],e[3]]])}return{query:n,recommendations:h,barFocus:m,currentLocation:u,selectSearchBarItem:R,queryModal:v,recommendationsModal:k,barFocusModal:S,currentLocationModal:y,selectSearchBarItemModal:$,maceioCrimesData:x,maceioCrimesTotalData:C,maceioCrimesLabelData:z}}}).mount("#app");
