import{createApp as j,ref as a,watch as G,onMounted as D,toRaw as R}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function _(s,e){var u=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),c=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),d=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),o=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});e.marker([-9.659,-35.701],{icon:u}).addTo(s.value),e.marker([-9.659,-35.702],{icon:c}).addTo(s.value),e.marker([-9.659,-35.703],{icon:d}).addTo(s.value),e.marker([-9.659,-35.704],{icon:u}).addTo(s.value),e.marker([-9.659,-35.705],{icon:o}).addTo(s.value),e.heatLayer([[-9.659,-35.701,1],[-9.659,-35.702,2],[-9.659,-35.703,3],[-9.659,-35.704,4],[-9.659,-35.705,5]],{radius:20}).addTo(s.value)}j({setup(){const s=window.location.protocol+"//"+window.location.host+"/api/",e=a(""),u=a(!1),c=a([]),d=a([]),o=a([]),C=a(14),y=a([]),i=a({}),m=a({}),h=a({});let v=new AbortController,b=v.signal;const w=a([]),k=a(0),A=a([]);G(e,r=>{v.abort(),v=new AbortController,b=v.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(r)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:b}).then(t=>t.json()).then(t=>{c.value=[],d.value=t,t.forEach(n=>{let g=n.display_name.indexOf(","),l=n.display_name.substring(g+1).trim(),p=n.address.postcode!==void 0?` - ${n.address.postcode}`:"";c.value.push({display:`${n.name} <span class="text-black-50 fst-italic">- ${l}${p}</span>`})})}).catch(t=>{t.name!=="AbortError"&&console.error("Another error: ",t)})}),D(async()=>{var r=L.layerGroup(),t=L.layerGroup(),n=[];n.push(r),await fetch(s+"reports/crimes").then(l=>l.json()).then(l=>{l.forEach(p=>{let f=[];p.reports.forEach(z=>{let O=L.marker([Number(z.lat),Number(z.lon)]);f.push(O)});let T=L.layerGroup(f);y.value[p.name]=T,n.push(T),w.value.push(f.length),A.value.push(p.name),k.value+=f.length})}).catch(l=>console.error(l)),o.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:n,minZoom:3,maxZoom:19,maxBounds:L.latLngBounds([-90,-180],[90,180]),wraparound:!0}).setView([-9.663136558749533,-35.71422457695007],C.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{noWrap:!0,worldCopyJump:!0}).addTo(o.value),L.control.zoom({position:"bottomright"}).addTo(o.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(o.value),_(o,L);var g={'<input type="date">':t,"em até 3 meses":r};L.control.layers(g,R(y.value),{position:"topright",collapsed:!1,sortLayers:!0}).addTo(o.value)});function S(r){u.value=!1,e.value="",i.value=d.value[r],U(),x(),M(),new bootstrap.Offcanvas("#LocationInfo").show()}function U(){Object.keys(m.value).length!==0&&o.value.removeLayer(m.value),m.value=L.geoJSON(i.value.geojson,{style:{fill:!1}}),m.value.addTo(o.value)}function x(){Object.keys(h.value).length!==0&&o.value.removeLayer(h.value),h.value=L.marker([Number(i.value.lat),Number(i.value.lon)]),h.value.addTo(o.value)}function M(){let r=i.value.boundingbox.map(Number);r[2]-=.4,o.value.fitBounds([[r[0],r[2]],[r[1],r[3]]])}return{query:e,recommendations:c,barFocus:u,currentLocation:i,selectSearchBarItem:S,maceioCrimesData:w,maceioCrimesTotalData:k,maceioCrimesLabelData:A}}}).mount("#app");
