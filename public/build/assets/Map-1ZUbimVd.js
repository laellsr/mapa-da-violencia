import{createApp as $,ref as e,watch as O,onMounted as N,toRaw as B}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function q(l,t){var d=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),p=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),v=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),m=t.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});t.marker([-9.659,-35.701],{icon:d}).addTo(l.value),t.marker([-9.659,-35.702],{icon:p}).addTo(l.value),t.marker([-9.659,-35.703],{icon:v}).addTo(l.value),t.marker([-9.659,-35.704],{icon:d}).addTo(l.value),t.marker([-9.659,-35.705],{icon:m}).addTo(l.value)}$({setup(){const l=window.location.protocol+"//"+window.location.host+"/api/",t=e(""),d=e(!1),p=e([]),v=e([]),m=e(""),A=e(!1),k=e([]),M=e([]),f=e({}),n=e([]),U=e(14),z=e([]),u=e({}),g=e({}),y=e({});let c=new AbortController,b=c.signal;const C=e([]),S=e(0),T=e([]);O(t,a=>{c.abort(),c=new AbortController,b=c.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(a)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:b}).then(o=>o.json()).then(o=>{p.value=[],v.value=o,o.forEach(r=>{let h=r.display_name.indexOf(","),s=r.display_name.substring(h+1).trim(),i=r.address.postcode!==void 0?` - ${r.address.postcode}`:"";p.value.push({display:`${r.name} <span class="text-black-50 fst-italic">- ${s}${i}</span>`})})}).catch(o=>{o.name!=="AbortError"&&console.error("Another error: ",o)})}),O(m,a=>{c.abort(),c=new AbortController,b=c.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(a)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:b}).then(o=>o.json()).then(o=>{k.value=[],M.value=o,o.forEach(r=>{let h=r.display_name.indexOf(","),s=r.display_name.substring(h+1).trim(),i=r.address.postcode!==void 0?` - ${r.address.postcode}`:"";k.value.push({display:`${r.name} <span class="text-black-50 fst-italic">- ${s}${i}</span>`})})}).catch(o=>{o.name!=="AbortError"&&console.error("Another error: ",o)})}),N(async()=>{var a=L.layerGroup(),o=L.layerGroup(),r=[];r.push(a),await fetch(l+"reports/crimes").then(s=>s.json()).then(s=>{s.forEach(i=>{let w=[];i.reports.forEach(j=>{let R=L.marker([Number(j.lat),Number(j.lon)]);w.push(R)});let x=L.layerGroup(w);z.value[i.name]=x,r.push(x),C.value.push(w.length),T.value.push(i.name),S.value+=w.length})}).catch(s=>console.error(s)),n.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:r,minZoom:3,maxZoom:19,maxBounds:L.latLngBounds([-90,-180],[90,180]),wraparound:!0}).setView([-9.663136558749533,-35.71422457695007],U.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{noWrap:!0,worldCopyJump:!0}).addTo(n.value),L.control.zoom({position:"bottomright"}).addTo(n.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(n.value),q(n,L);var h={'<input type="date">':o,"em até 3 meses":a};L.control.layers(h,B(z.value),{position:"topright",collapsed:!1,sortLayers:!0}).addTo(n.value)});function _(a){d.value=!1,t.value="",u.value=v.value[a],D(),E(),G(),new bootstrap.Offcanvas("#LocationInfo").show()}function I(a){A.value=!1,f.value=M.value[a],m.value=f.value.name,localStorage.setItem("currentLocationModal",JSON.stringify(f.value))}function D(){Object.keys(g.value).length!==0&&n.value.removeLayer(g.value),g.value=L.geoJSON(u.value.geojson,{style:{fill:!1}}),g.value.addTo(n.value)}function E(){Object.keys(y.value).length!==0&&n.value.removeLayer(y.value),y.value=L.marker([Number(u.value.lat),Number(u.value.lon)]),y.value.addTo(n.value)}function G(){let a=u.value.boundingbox.map(Number);a[2]-=.4,n.value.fitBounds([[a[0],a[2]],[a[1],a[3]]])}return{query:t,recommendations:p,barFocus:d,currentLocation:u,selectSearchBarItem:_,queryModal:m,recommendationsModal:k,barFocusModal:A,currentLocationModal:f,selectSearchBarItemModal:I,maceioCrimesData:C,maceioCrimesTotalData:S,maceioCrimesLabelData:T}}}).mount("#app");
