import{createApp as x,ref as r,watch as M,onMounted as O,toRaw as j}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function G(s,e){var u=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),c=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),d=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),o=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});e.marker([-9.659,-35.701],{icon:u}).addTo(s.value),e.marker([-9.659,-35.702],{icon:c}).addTo(s.value),e.marker([-9.659,-35.703],{icon:d}).addTo(s.value),e.marker([-9.659,-35.704],{icon:u}).addTo(s.value),e.marker([-9.659,-35.705],{icon:o}).addTo(s.value),e.heatLayer([[-9.659,-35.701,1],[-9.659,-35.702,2],[-9.659,-35.703,3],[-9.659,-35.704,4],[-9.659,-35.705,5]],{radius:20}).addTo(s.value)}x({setup(){const s=window.location.protocol+"//"+window.location.host+"/api/",e=r(""),u=r(!1),c=r([]),d=r([]),o=r([]),A=r(14),y=r([]),i=r({}),p=r({}),m=r({});let h=new AbortController,g=h.signal;M(e,a=>{h.abort(),h=new AbortController,g=h.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(a)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:g}).then(t=>t.json()).then(t=>{c.value=[],d.value=t,t.forEach(n=>{let f=n.display_name.indexOf(","),l=n.display_name.substring(f+1).trim(),v=n.address.postcode!==void 0?` - ${n.address.postcode}`:"";c.value.push({display:`${n.name} <span class="text-black-50 fst-italic">- ${l}${v}</span>`})})}).catch(t=>{t.name!=="AbortError"&&console.error("Another error: ",t)})}),O(async()=>{var a=L.layerGroup(),t=L.layerGroup(),n=[];n.push(a),await fetch(s+"reports/crimes").then(l=>l.json()).then(l=>{l.forEach(v=>{let b=[];v.reports.forEach(k=>{let U=L.marker([Number(k.lat),Number(k.lon)]);b.push(U)});let w=L.layerGroup(b);y.value[v.name]=w,n.push(w)})}).catch(l=>console.error(l)),o.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:n,minZoom:3,maxZoom:19,maxBounds:L.latLngBounds([-90,-180],[90,180]),wraparound:!0}).setView([-9.663136558749533,-35.71422457695007],A.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{noWrap:!0,worldCopyJump:!0}).addTo(o.value),L.control.zoom({position:"bottomright"}).addTo(o.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(o.value),G(o,L);var f={'<input type="date">':t,"em até 3 meses":a};L.control.layers(f,j(y.value),{position:"topright",collapsed:!1,sortLayers:!0}).addTo(o.value)});function z(a){u.value=!1,e.value="",i.value=d.value[a],T(),C(),S(),new bootstrap.Offcanvas("#LocationInfo").show()}function T(){Object.keys(p.value).length!==0&&o.value.removeLayer(p.value),p.value=L.geoJSON(i.value.geojson,{style:{fill:!1}}),p.value.addTo(o.value)}function C(){Object.keys(m.value).length!==0&&o.value.removeLayer(m.value),m.value=L.marker([Number(i.value.lat),Number(i.value.lon)]),m.value.addTo(o.value)}function S(){let a=i.value.boundingbox.map(Number);a[2]-=.4,o.value.fitBounds([[a[0],a[2]],[a[1],a[3]]])}return{query:e,recommendations:c,barFocus:u,currentLocation:i,selectSearchBarItem:z}}}).mount("#app");
