import{createApp as z,ref as n,watch as T,onMounted as S}from"https://unpkg.com/vue@3/dist/vue.esm-browser.js";function C(r,e){var i=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/medium_risk-eGVVO0mf.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),c=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/high_danger-EreEzYfv.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),s=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/gun-e6pOFlTz.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),u=e.icon({iconUrl:new URL("http://safetymap.edge.net.br/build/assets/murder-tlFDIjrO.png",import.meta.url).href,iconSize:[40,60],shadowSize:[50,64],iconAnchor:[20,60],shadowAnchor:[4,62],popupAnchor:[-3,-76]});e.marker([-9.659,-35.701],{icon:i}).addTo(r.value),e.marker([-9.659,-35.702],{icon:c}).addTo(r.value),e.marker([-9.659,-35.703],{icon:s}).addTo(r.value),e.marker([-9.659,-35.704],{icon:i}).addTo(r.value),e.marker([-9.659,-35.705],{icon:u}).addTo(r.value),e.heatLayer([[-9.659,-35.701,1],[-9.659,-35.702,2],[-9.659,-35.703,3],[-9.659,-35.704,4],[-9.659,-35.705,5]],{radius:20}).addTo(r.value)}z({setup(){const r=n(""),e=n(!1),i=n([]),c=n([]),s=n({}),u=n({}),d=n({}),a=n([]),g=n(14);let p=new AbortController,f=p.signal;T(r,o=>{p.abort(),p=new AbortController,f=p.signal,fetch("https://nominatim.openstreetmap.org/search.php?q="+encodeURI(o)+"&format=jsonv2&addressdetails=1&polygon_geojson=1",{signal:f}).then(t=>t.json()).then(t=>{i.value=[],c.value=t,t.forEach(l=>{let m=l.display_name.indexOf(","),h=l.display_name.substring(m+1).trim(),v=l.address.postcode!==void 0?` - ${l.address.postcode}`:"";i.value.push({display:`${l.name} <span class="text-black-50 fst-italic">- ${h}${v}</span>`})})}).catch(t=>{t.name!=="AbortError"&&console.error("Another error: ",t)})}),S(()=>{var o=L.layerGroup(),t=L.layerGroup(),l=L.layerGroup([L.marker([-9.664,-35.701])]),m=L.layerGroup([L.marker([-9.664,-35.702])]),h=L.layerGroup([L.marker([-9.664,-35.703])]);a.value=L.map("map",{zoomControl:!1,attributionControl:!1,layers:[o,l,m,h]}).setView([-9.663136558749533,-35.71422457695007],g.value),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(a.value),L.control.zoom({position:"bottomright"}).addTo(a.value),L.control.locate({position:"bottomright",flyTo:!1,drawCircle:!0,showPopup:!1,markerClass:L.circleMarker,strings:{title:"Mostrar minha localização",popup:"Você está dentro de {distance} {unit} deste ponto"},locateOptions:{maxZoom:16}}).addTo(a.value),C(a,L);var v={Homicídio:l,Furto:m,Roubo:h},A={'<input type="date">':t,"em até 3 meses":o};L.control.layers(A,v,{position:"topright",collapsed:!1,sortLayers:!0}).addTo(a.value)});function y(o){e.value=!1,r.value="",s.value=c.value[o],b(),w(),k(),new bootstrap.Offcanvas("#LocationInfo").show()}function b(){Object.keys(u.value).length!==0&&a.value.removeLayer(u.value),u.value=L.geoJSON(s.value.geojson,{style:{fill:!1}}),u.value.addTo(a.value)}function w(){Object.keys(d.value).length!==0&&a.value.removeLayer(d.value),d.value=L.marker([Number(s.value.lat),Number(s.value.lon)]),d.value.addTo(a.value)}function k(){let o=s.value.boundingbox.map(Number);o[2]-=.4,a.value.fitBounds([[o[0],o[2]],[o[1],o[3]]])}return{query:r,recommendations:i,barFocus:e,currentLocation:s,selectSearchBarItem:y}}}).mount("#app");
