@extends('_template')

@push('styles')
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
@endpush

@section('content')
    <div id="app">
        <div id="map" @focusin="barFocus=false"></div>
        <div id="boxes-layer">
            @include('_search-bar')
            <img class="map-logo ms-3 mb-3" src="{{ Vite::asset('resources/img/logo_2.png') }}" draggable="false" alt="Safety Map - Percorra com seguranÃ§a">
            @include('_statistics-offcanvas')
            <button type="button" class="btn-mdenunciar" data-bs-toggle="modal" data-bs-target="#reportModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" fill="none">
                    <g clip-path="url(#clip0_142_8)">
                    <path d="M49.9999 99.3827C77.2732 99.3827 99.3826 77.2733 99.3826 50C99.3826 22.7267 77.2732 0.61731 49.9999 0.61731C22.7266 0.61731 0.617188 22.7267 0.617188 50C0.617188 77.2733 22.7266 99.3827 49.9999 99.3827Z" fill="#3A3A3A" stroke="#FFB800" stroke-width="2"/>
                    <path d="M49.9976 7.60742C51.3692 7.60742 52.6309 8.43458 53.326 9.79014L74.1606 50.3543C74.8655 51.721 74.8655 53.4074 74.1803 54.7741C73.4951 56.1408 72.2124 56.9901 70.8334 56.9901H29.1643C27.7853 56.9901 26.5025 56.1408 25.8174 54.7741C25.1322 53.4074 25.142 51.7099 25.8371 50.3543L46.6717 9.79014C47.3655 8.43458 48.6297 7.60742 49.9976 7.60742ZM49.9976 21.7173C48.7149 21.7173 47.684 22.8963 47.684 24.3617V36.7074C47.684 38.1741 48.7149 39.3531 49.9976 39.3531C51.2815 39.3531 52.3136 38.1741 52.3136 36.7074V24.3617C52.3136 22.8963 51.2815 21.7173 49.9976 21.7173ZM53.0852 46.4087C53.0852 43.6926 50.5124 41.9951 48.4556 43.3531C47.5013 43.984 46.9112 45.1482 46.9112 46.4087C46.9112 49.1235 49.484 50.821 51.5433 49.463C52.4964 48.8333 53.0852 47.6679 53.0852 46.4087Z" fill="#D30000" stroke="#760000" stroke-width="4"/>
                    <path d="M51.8521 22.7753H48.1484V38.5098H51.8521V22.7753Z" fill="#D8D8D8"/>
                    <path d="M50.0004 48.8864C51.3641 48.8864 52.4695 47.7809 52.4695 46.4173C52.4695 45.0536 51.3641 43.9481 50.0004 43.9481C48.6367 43.9481 47.5312 45.0536 47.5312 46.4173C47.5312 47.7809 48.6367 48.8864 50.0004 48.8864Z" fill="#D8D8D8"/>
                    <path d="M20.3926 71H17.2505V60.8182H20.5318C21.5195 60.8182 22.3646 61.022 23.0673 61.4297C23.7699 61.834 24.3085 62.4157 24.6831 63.1747C25.0576 63.9304 25.2449 64.8352 25.2449 65.8892C25.2449 66.9498 25.0559 67.8629 24.6781 68.6286C24.3002 69.3909 23.7501 69.9775 23.0275 70.3885C22.305 70.7962 21.4267 71 20.3926 71ZM18.4835 69.9062H20.313C21.1549 69.9062 21.8526 69.7438 22.4061 69.419C22.9596 69.0942 23.3722 68.6319 23.644 68.032C23.9158 67.4321 24.0517 66.7178 24.0517 65.8892C24.0517 65.0672 23.9174 64.3596 23.649 63.7663C23.3805 63.1697 22.9795 62.7124 22.4458 62.3942C21.9122 62.0727 21.2477 61.9119 20.4522 61.9119H18.4835V69.9062ZM30.3556 71.1591C29.6199 71.1591 28.9851 70.9967 28.4515 70.6719C27.9212 70.3438 27.5119 69.8864 27.2235 69.2997C26.9385 68.7098 26.796 68.0237 26.796 67.2415C26.796 66.4593 26.9385 65.7699 27.2235 65.1733C27.5119 64.5734 27.9129 64.1061 28.4267 63.7713C28.9437 63.4332 29.5469 63.2642 30.2363 63.2642C30.6341 63.2642 31.0268 63.3305 31.4146 63.4631C31.8024 63.5956 32.1554 63.8111 32.4735 64.1094C32.7917 64.4044 33.0453 64.7955 33.2342 65.2827C33.4231 65.7699 33.5176 66.3698 33.5176 67.0824V67.5795H27.6312V66.5653H32.3244C32.3244 66.1345 32.2382 65.75 32.0659 65.4119C31.8968 65.0739 31.6549 64.8071 31.34 64.6115C31.0285 64.416 30.6606 64.3182 30.2363 64.3182C29.769 64.3182 29.3646 64.4342 29.0233 64.6662C28.6852 64.8949 28.425 65.1932 28.2427 65.5611C28.0604 65.929 27.9693 66.3234 27.9693 66.7443V67.4205C27.9693 67.9972 28.0687 68.486 28.2676 68.8871C28.4698 69.2848 28.7498 69.5881 29.1078 69.7969C29.4657 70.0024 29.8817 70.1051 30.3556 70.1051C30.6639 70.1051 30.9423 70.062 31.1909 69.9759C31.4428 69.8864 31.6599 69.7538 31.8422 69.5781C32.0244 69.3991 32.1653 69.1771 32.2647 68.9119L33.3983 69.2301C33.2789 69.6146 33.0784 69.9527 32.7967 70.2443C32.515 70.5327 32.167 70.758 31.7527 70.9205C31.3384 71.0795 30.8727 71.1591 30.3556 71.1591ZM36.4757 66.4062V71H35.3024V63.3636H36.4359V64.5568H36.5353C36.7143 64.169 36.9861 63.8575 37.3507 63.6222C37.7153 63.3835 38.1859 63.2642 38.7626 63.2642C39.2797 63.2642 39.7321 63.3703 40.1199 63.5824C40.5076 63.7912 40.8092 64.1094 41.0247 64.5369C41.2401 64.9612 41.3478 65.4981 41.3478 66.1477V71H40.1745V66.2273C40.1745 65.6274 40.0188 65.16 39.7072 64.8253C39.3957 64.4872 38.9681 64.3182 38.4245 64.3182C38.05 64.3182 37.7153 64.3994 37.4203 64.5618C37.1286 64.7242 36.8983 64.9612 36.7292 65.2727C36.5602 65.5843 36.4757 65.9621 36.4757 66.4062ZM48.3043 67.8778V63.3636H49.4776V71H48.3043V69.7074H48.2248C48.0458 70.0952 47.7674 70.425 47.3896 70.6967C47.0117 70.9652 46.5344 71.0994 45.9577 71.0994C45.4805 71.0994 45.0562 70.995 44.685 70.7862C44.3138 70.5741 44.0221 70.2559 43.81 69.8317C43.5979 69.4041 43.4918 68.8655 43.4918 68.2159V63.3636H44.6651V68.1364C44.6651 68.6932 44.8209 69.1373 45.1325 69.4688C45.4473 69.8002 45.8484 69.9659 46.3356 69.9659C46.6272 69.9659 46.9239 69.8913 47.2255 69.7422C47.5304 69.593 47.7856 69.3643 47.9911 69.0561C48.1999 68.7479 48.3043 68.3551 48.3043 67.8778ZM52.7999 66.4062V71H51.6266V63.3636H52.7601V64.5568H52.8596C53.0385 64.169 53.3103 63.8575 53.6749 63.6222C54.0395 63.3835 54.5101 63.2642 55.0868 63.2642C55.6039 63.2642 56.0563 63.3703 56.4441 63.5824C56.8319 63.7912 57.1335 64.1094 57.3489 64.5369C57.5643 64.9612 57.6721 65.4981 57.6721 66.1477V71H56.4988V66.2273C56.4988 65.6274 56.343 65.16 56.0314 64.8253C55.7199 64.4872 55.2923 64.3182 54.7488 64.3182C54.3742 64.3182 54.0395 64.3994 53.7445 64.5618C53.4528 64.7242 53.2225 64.9612 53.0534 65.2727C52.8844 65.5843 52.7999 65.9621 52.7999 66.4062ZM62.9183 71.1591C62.2024 71.1591 61.5859 70.9901 61.0689 70.652C60.5518 70.3139 60.1541 69.8482 59.8757 69.255C59.5973 68.6617 59.4581 67.9839 59.4581 67.2216C59.4581 66.446 59.6006 65.7616 59.8857 65.1683C60.174 64.5717 60.575 64.1061 61.0888 63.7713C61.6058 63.4332 62.209 63.2642 62.8984 63.2642C63.4354 63.2642 63.9193 63.3636 64.3501 63.5625C64.781 63.7614 65.134 64.0398 65.4091 64.3977C65.6842 64.7557 65.8549 65.1733 65.9212 65.6506H64.7479C64.6584 65.3026 64.4595 64.9943 64.1513 64.7259C63.8464 64.4541 63.4354 64.3182 62.9183 64.3182C62.4609 64.3182 62.0599 64.4375 61.7152 64.6761C61.3738 64.9115 61.107 65.2446 60.9148 65.6754C60.7259 66.103 60.6314 66.6051 60.6314 67.1818C60.6314 67.7718 60.7242 68.2855 60.9098 68.723C61.0987 69.1605 61.3639 69.5002 61.7053 69.7422C62.05 69.9841 62.4543 70.1051 62.9183 70.1051C63.2232 70.1051 63.5 70.0521 63.7486 69.946C63.9972 69.84 64.2076 69.6875 64.38 69.4886C64.5523 69.2898 64.675 69.0511 64.7479 68.7727H65.9212C65.8549 69.2235 65.6908 69.6295 65.429 69.9908C65.1705 70.3487 64.8274 70.6338 64.3999 70.8459C63.9756 71.0547 63.4818 71.1591 62.9183 71.1591ZM67.6364 71V63.3636H68.8097V71H67.6364ZM68.233 62.0909C68.0043 62.0909 67.8071 62.013 67.6413 61.8572C67.4789 61.7015 67.3977 61.5142 67.3977 61.2955C67.3977 61.0767 67.4789 60.8894 67.6413 60.7337C67.8071 60.5779 68.0043 60.5 68.233 60.5C68.4616 60.5 68.6572 60.5779 68.8196 60.7337C68.9853 60.8894 69.0682 61.0767 69.0682 61.2955C69.0682 61.5142 68.9853 61.7015 68.8196 61.8572C68.6572 62.013 68.4616 62.0909 68.233 62.0909ZM73.2058 71.179C72.7219 71.179 72.2827 71.0878 71.8883 70.9055C71.4939 70.7199 71.1807 70.4531 70.9487 70.1051C70.7167 69.7538 70.6007 69.3295 70.6007 68.8324C70.6007 68.3949 70.6868 68.0402 70.8592 67.7685C71.0315 67.4934 71.2619 67.2779 71.5502 67.1222C71.8386 66.9664 72.1568 66.8504 72.5048 66.7741C72.8561 66.6946 73.2091 66.6316 73.5637 66.5852C74.0278 66.5256 74.4039 66.4808 74.6923 66.451C74.984 66.4179 75.1961 66.3632 75.3287 66.2869C75.4645 66.2107 75.5325 66.0781 75.5325 65.8892V65.8494C75.5325 65.3589 75.3983 64.9777 75.1298 64.706C74.8646 64.4342 74.4619 64.2983 73.9217 64.2983C73.3616 64.2983 72.9224 64.4209 72.6042 64.6662C72.286 64.9115 72.0623 65.1733 71.9331 65.4517L70.8194 65.054C71.0183 64.59 71.2834 64.2287 71.6149 63.9702C71.9496 63.7083 72.3142 63.526 72.7086 63.4233C73.1064 63.3172 73.4975 63.2642 73.8819 63.2642C74.1272 63.2642 74.4089 63.294 74.7271 63.3537C75.0486 63.41 75.3585 63.5277 75.6568 63.7067C75.9584 63.8857 76.2086 64.1558 76.4075 64.517C76.6064 64.8783 76.7058 65.3622 76.7058 65.9688V71H75.5325V69.9659H75.4728C75.3933 70.1316 75.2607 70.3089 75.0751 70.4979C74.8895 70.6868 74.6426 70.8475 74.3343 70.9801C74.0261 71.1127 73.6499 71.179 73.2058 71.179ZM73.3848 70.125C73.8488 70.125 74.2399 70.0339 74.5581 69.8516C74.8796 69.6693 75.1215 69.4339 75.2839 69.1456C75.4496 68.8572 75.5325 68.554 75.5325 68.2358V67.1619C75.4828 67.2216 75.3734 67.2763 75.2044 67.326C75.0386 67.3724 74.8464 67.4138 74.6277 67.4503C74.4122 67.4834 74.2018 67.5133 73.9963 67.5398C73.7941 67.563 73.63 67.5829 73.5041 67.5994C73.1992 67.6392 72.9141 67.7038 72.649 67.7933C72.3871 67.8795 72.175 68.0104 72.0126 68.1861C71.8535 68.3584 71.774 68.5937 71.774 68.892C71.774 69.2997 71.9248 69.608 72.2264 69.8168C72.5313 70.0223 72.9174 70.125 73.3848 70.125ZM78.8473 71V63.3636H79.9808V64.517H80.0604C80.1996 64.1392 80.4515 63.8326 80.8161 63.5973C81.1806 63.362 81.5916 63.2443 82.049 63.2443C82.1352 63.2443 82.2429 63.246 82.3722 63.2493C82.5014 63.2526 82.5992 63.2576 82.6655 63.2642V64.4574C82.6257 64.4474 82.5346 64.4325 82.392 64.4126C82.2528 64.3894 82.1054 64.3778 81.9496 64.3778C81.5784 64.3778 81.2469 64.4557 80.9553 64.6115C80.6669 64.764 80.4382 64.9761 80.2692 65.2479C80.1035 65.5163 80.0206 65.8229 80.0206 66.1676V71H78.8473ZM39.4095 81H38.1766C38.1037 80.6454 37.9761 80.3338 37.7938 80.0653C37.6148 79.7969 37.396 79.5715 37.1375 79.3892C36.8823 79.2036 36.5989 79.0644 36.2874 78.9716C35.9758 78.8788 35.651 78.8324 35.3129 78.8324C34.6965 78.8324 34.138 78.9882 33.6375 79.2997C33.1404 79.6113 32.7443 80.0703 32.4493 80.6768C32.1576 81.2834 32.0118 82.0275 32.0118 82.9091C32.0118 83.7907 32.1576 84.5348 32.4493 85.1413C32.7443 85.7479 33.1404 86.2069 33.6375 86.5185C34.138 86.83 34.6965 86.9858 35.3129 86.9858C35.651 86.9858 35.9758 86.9394 36.2874 86.8466C36.5989 86.7538 36.8823 86.6162 37.1375 86.4339C37.396 86.2483 37.6148 86.0213 37.7938 85.7528C37.9761 85.4811 38.1037 85.1695 38.1766 84.8182H39.4095C39.3167 85.3385 39.1477 85.8042 38.9024 86.2152C38.6572 86.6262 38.3522 86.9759 37.9877 87.2642C37.6231 87.5492 37.2137 87.7663 36.7597 87.9155C36.3089 88.0646 35.8267 88.1392 35.3129 88.1392C34.4446 88.1392 33.6723 87.9271 32.9962 87.5028C32.32 87.0786 31.7881 86.4754 31.4003 85.6932C31.0125 84.911 30.8186 83.983 30.8186 82.9091C30.8186 81.8352 31.0125 80.9072 31.4003 80.125C31.7881 79.3428 32.32 78.7396 32.9962 78.3153C33.6723 77.8911 34.4446 77.679 35.3129 77.679C35.8267 77.679 36.3089 77.7536 36.7597 77.9027C37.2137 78.0518 37.6231 78.2706 37.9877 78.5589C38.3522 78.844 38.6572 79.192 38.9024 79.603C39.1477 80.0107 39.3167 80.4763 39.4095 81ZM41.2428 88V80.3636H42.3763V81.517H42.4559C42.5951 81.1392 42.847 80.8326 43.2116 80.5973C43.5761 80.362 43.9871 80.2443 44.4445 80.2443C44.5307 80.2443 44.6384 80.246 44.7677 80.2493C44.8969 80.2526 44.9947 80.2576 45.061 80.2642V81.4574C45.0212 81.4474 44.9301 81.4325 44.7876 81.4126C44.6483 81.3894 44.5009 81.3778 44.3451 81.3778C43.9739 81.3778 43.6424 81.4557 43.3508 81.6115C43.0624 81.764 42.8337 81.9761 42.6647 82.2479C42.499 82.5163 42.4161 82.8229 42.4161 83.1676V88H41.2428ZM46.4518 88V80.3636H47.6251V88H46.4518ZM47.0484 79.0909C46.8197 79.0909 46.6225 79.013 46.4568 78.8572C46.2944 78.7015 46.2132 78.5142 46.2132 78.2955C46.2132 78.0767 46.2944 77.8894 46.4568 77.7337C46.6225 77.5779 46.8197 77.5 47.0484 77.5C47.2771 77.5 47.4726 77.5779 47.635 77.7337C47.8008 77.8894 47.8836 78.0767 47.8836 78.2955C47.8836 78.5142 47.8008 78.7015 47.635 78.8572C47.4726 79.013 47.2771 79.0909 47.0484 79.0909ZM49.7741 88V80.3636H50.9076V81.5568H51.007C51.1661 81.1491 51.423 80.8326 51.7776 80.6072C52.1323 80.3786 52.5581 80.2642 53.0553 80.2642C53.5591 80.2642 53.9784 80.3786 54.3131 80.6072C54.6512 80.8326 54.9147 81.1491 55.1036 81.5568H55.1831C55.3787 81.1624 55.672 80.8492 56.0631 80.6172C56.4542 80.3819 56.9232 80.2642 57.4701 80.2642C58.1528 80.2642 58.7113 80.478 59.1455 80.9055C59.5797 81.3298 59.7968 81.991 59.7968 82.8892V88H58.6235V82.8892C58.6235 82.3258 58.4694 81.9231 58.1611 81.6811C57.8529 81.4392 57.49 81.3182 57.0724 81.3182C56.5354 81.3182 56.1195 81.4806 55.8245 81.8054C55.5295 82.1269 55.382 82.5346 55.382 83.0284V88H54.1888V82.7699C54.1888 82.3357 54.048 81.986 53.7662 81.7209C53.4845 81.4524 53.1216 81.3182 52.6775 81.3182C52.3725 81.3182 52.0875 81.3994 51.8224 81.5618C51.5605 81.7242 51.3484 81.9496 51.186 82.2379C51.0269 82.523 50.9474 82.8527 50.9474 83.2273V88H49.7741ZM65.1437 88.1591C64.4079 88.1591 63.7732 87.9967 63.2396 87.6719C62.7093 87.3438 62.3 86.8864 62.0116 86.2997C61.7266 85.7098 61.5841 85.0237 61.5841 84.2415C61.5841 83.4593 61.7266 82.7699 62.0116 82.1733C62.3 81.5734 62.701 81.1061 63.2148 80.7713C63.7318 80.4332 64.335 80.2642 65.0244 80.2642C65.4221 80.2642 65.8149 80.3305 66.2027 80.4631C66.5905 80.5956 66.9434 80.8111 67.2616 81.1094C67.5798 81.4044 67.8334 81.7955 68.0223 82.2827C68.2112 82.7699 68.3057 83.3698 68.3057 84.0824V84.5795H62.4193V83.5653H67.1125C67.1125 83.1345 67.0263 82.75 66.854 82.4119C66.6849 82.0739 66.443 81.8071 66.1281 81.6115C65.8166 81.416 65.4487 81.3182 65.0244 81.3182C64.5571 81.3182 64.1527 81.4342 63.8113 81.6662C63.4733 81.8949 63.2131 82.1932 63.0308 82.5611C62.8485 82.929 62.7574 83.3234 62.7574 83.7443V84.4205C62.7574 84.9972 62.8568 85.486 63.0557 85.8871C63.2578 86.2848 63.5379 86.5881 63.8959 86.7969C64.2538 87.0024 64.6698 87.1051 65.1437 87.1051C65.452 87.1051 65.7304 87.062 65.979 86.9759C66.2309 86.8864 66.4479 86.7538 66.6302 86.5781C66.8125 86.3991 66.9534 86.1771 67.0528 85.9119L68.1863 86.2301C68.067 86.6146 67.8665 86.9527 67.5848 87.2443C67.3031 87.5327 66.955 87.758 66.5407 87.9205C66.1265 88.0795 65.6608 88.1591 65.1437 88.1591Z" fill="white"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_142_8">
                    <rect width="100" height="100" fill="white"/>
                    </clipPath>
                    </defs>
                </svg> 
            </button>
            <div v-show="showLoading" id="loadingSpinner" class="bg-white rounded shadow-sm border border-dark row justify-content-center align-items-center text-center">
                <div class="col">
                    <span class="spinner-border text-dark"></span>
                    <p class="m-0" role="status">Carregando...</p>
                </div>
            </div>
            <div v-show="heatmapGradientBar" class="gradient-bar-conteiner text-center">
                {{-- bg-white p-1 px-2 rounded shadow-sm border border-dark-50 --}}
                <small class="mb-1">Intensidade da gravidade de ocorrÃªncias</small>
                <div class="gradient-bar mb-1 rounded"></div>
            </div>
        </div>
        {{-- <div id="footer-background" class="shadow-lg"></div> --}}
    </div>
    @include('_report-modal')
@endsection

@push('scripts')
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.heat@0.2.0/dist/leaflet-heat.min.js"></script>
    <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src="{{ Vite::asset('resources/js/components/Map.js') }}" type="module"></script>
@endpush
